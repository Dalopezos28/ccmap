{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title|default:"Mapa de Red" }}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/network.css' %}">
{% endblock %}

{% block content %}
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="title-section">
                <h1>üåê Mapa de Transformaci√≥n Social</h1>
                <p>Red de Comedores Comunitarios de Cali</p>
            </div>
            <div class="stats-grid" id="stats-grid">
                <div class="stat-card">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Barrios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Comedores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Cupos Totales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">-</div>
                    <div class="stat-label">Promedio/Barrio</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <h2>üîç Explorar Red</h2>

            <div class="filter-section">
                <h3>Buscar</h3>
                <input type="text" class="search-box" id="search-input" placeholder="Buscar barrio o comedor...">
            </div>

            <div class="filter-section">
                <h3>Controles</h3>
                <div class="controls">
                    <button class="btn btn-primary" onclick="resetGraph()">‚Üª Reiniciar</button>
                    <button class="btn btn-secondary" onclick="centerGraph()">‚äô Centrar</button>
                </div>
            </div>

            <div class="filter-section">
                <h3>Categor√≠as por Cupos</h3>
                <div id="legend-categorias"></div>
            </div>

            <div class="filter-section">
                <h3>Tipos de Comida</h3>
                <div id="legend-tipos"></div>
            </div>

            <div class="filter-section">
                <h3>‚ÑπÔ∏è Informaci√≥n</h3>
                <p style="font-size: 12px; color: #7f8c8d; line-height: 1.6;">
                    Los <strong>nodos grandes</strong> representan barrios y los <strong>nodos peque√±os</strong> son los comedores.
                    <br><br>
                    Haz <strong>clic</strong> en un nodo para ver detalles, <strong>arrastra</strong> para reorganizar,
                    y usa el <strong>scroll</strong> para hacer zoom.
                </p>
            </div>
        </div>

        <!-- Graph -->
        <div class="graph-container">
            <a href="{% url 'mapa' %}" class="nav-link">‚Üê Volver al Mapa</a>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <div>Cargando red de comedores...</div>
            </div>

            <svg id="network-graph"></svg>

            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
            </div>

            <div class="tooltip" id="tooltip"></div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="{% static 'js/network.js' %}"></script>
{% endblock %}